---
title: Agentica > Guide Documents > WebSocket Protocol > NestJS Server
---
import { Tabs } from 'nextra/components'

## Setup
<Tabs items={['npm', 'pnpm', 'yarn']}>
  <Tabs.Tab>
```bash filename="Terminal" copy
npm install @nestjs/common @nestjs/core @nestjs/platform-express
npm install @agentica/core @samchon/openapi
npm install @agentica/rpc tgrid

npm install -D nestia
npx nestia setup
```
  </Tabs.Tab>
  <Tabs.Tab>
```bash filename="Terminal" copy
pnpm install @nestjs/common @nestjs/core @nestjs/platform-express
pnpm install @agentica/core @samchon/openapi
pnpm install @agentica/rpc tgrid

pnpm install -D nestia
pnpm nestia setup
```
  </Tabs.Tab>
  <Tabs.Tab>
```bash filename="Terminal" copy
# YARN BERRY IS NOT SUPPORTED
yarn add @nestjs/common @nestjs/core @nestjs/platform-express
yarn add @agentica/core @samchon/openapi
yarn add @agentica/rpc tgrid

yarn add -D nestia
yarn nestia setup
```
  </Tabs.Tab>
</Tabs>




## Bootstrap
```typescript filename="nestjs/src/main.ts" showLineNumbers copy
import { WebSocketAdaptor } from "@nestia/core";
import { INestApplication } from "@nestjs/common";
import { NestFactory } from "@nestjs/core";

import { MyModule } from "./MyModule";

const app: INestApplication = await NestFactory.create(MyModule);
await WebSocketAdaptor.upgrade(app);
await app.listen(3_001, "0.0.0.0");
```

To activate WebSocket protocol in NestJS, you have to upgrade the NestJS application by `WebSocketAdaptor.upgrade()` function. The upgrade function will make NestJS application to support both HTTP and WebSocket protocols.




## API Controller
```typescript filename="nestjs/src/chat.controller.ts" showLineNumbers copy
import { 
  AgenticaRpcService,
  IAgenticaRpcListener,
  IAgenticaRpcListener
} from "@agentica/rpc";
import { WebSocketRoute } from "@nestia/core";
import { Controller } from "@nestjs/common";
import { Driver, WebSocketAcceptor } from "tgrid";

@Controller("chat")
export class ChatController {
  @WebSocketRoute()
  public async start(
    // @WebSocketRoute.Param("id") id: string,
    @WebSocketRoute.Acceptor()
    acceptor: WebSocketAcceptor<
      null, // header
      AgenticaRpcService<"chatgpt">,
      IAgenticaRpcListener
    >,
  ): Promise<void> {
    const agent: Agentica<"chatgpt"> = new Agentica({ ... });
    const listener: Driver<IAgenticaRpcListener> = acceptor.getDriver();
    const service: AgenticaRpcService<"chatgpt"> = 
      new AgenticaRpcService({
        agent,
        listener,
      });
    await acceptor.accept(service);
  }
}
```

You can finalize WebSocket server development like above.

At first, create a controller method decorated by `@WebSocketRoute()`. And in the controller method, define a parameter that is decorated by `@WebSocketRoute.Acceptor()` with the type of `WebSocketAcceptor` specializing `IAgenticaRpcService` and `IAgenticaRpcListener` types.

And in the controller method body, create an `Agentica` instance and wrap it into a new `AgenticaRpcService` instance. And then accept the client connection by calling the `WebSocketAcceptor.accept()` function with the `AgenticaRpcService` instance.

When you've completed the acceptance, everything is completed. When client calls the `IAgenticaRpcService.conversate()` function remotely, server will response to the client by calling the `IAgenticaRpcListener` functions remotely too.




## Software Development Kit
<Tabs items={['npm', 'pnpm', 'yarn']}>
  <Tabs.Tab>
```bash filename="Terminal" copy
npx nestia sdk
```
  </Tabs.Tab>
  <Tabs.Tab>
```bash filename="Terminal" copy
pnpm nestia sdk
```
  </Tabs.Tab>
  <Tabs.Tab>
```bash filename="Terminal" copy
yarn nestia sdk
```
  </Tabs.Tab>
</Tabs>


<Tabs items={["Main Program", "SDK Library"]}>
  <Tabs.Tab>
```typescript filename="client/src/main.ts" showLineNumbers copy
import api from "@ORGANIZATION/PROJECT-api";

const { connector, driver } = await api.functional.chat.start(
  {
    host: "http://localhost:30001",
  },
  {
    text: async (evt) => {
    console.log(evt.role, evt.text);
    },
    select: async (evt) => {
      console.log("selector", evt.selection);
    },
    execute: async (evt) => {
      console.log("execute", evt.operation, evt.arguments, evt.value);
    },
    describe: async (evt) => {
      console.log("describer", evt.text);
    },
  },
);

await driver.conversate("Hello, what can you do?");

await connector.close();
```
  </Tabs.Tab>
  <Tabs.Tab>
```typescript filename="server/api/functional/chat/index.ts" showLineNumbers copy
/**
 * @packageDocumentation
 * @module api.functional.chat
 * @nestia Generated by Nestia - https://github.com/samchon/nestia
 */
//================================================================
import type { IAgenticaRpcListener } from "@agentica/rpc/lib/IAgenticaRpcListener";
import type { IAgenticaRpcService } from "@agentica/rpc/lib/IAgenticaRpcService";
import type { IConnection } from "@nestia/fetcher";
import { WebSocketConnector } from "tgrid";
import type { Driver } from "tgrid";

/**
 * @controller MyChatController.start
 * @path /chat
 * @nestia Generated by Nestia - https://github.com/samchon/nestia
 */
export async function start(
  connection: IConnection<start.Header>,
  provider: start.Provider,
): Promise<start.Output> {
  const connector: WebSocketConnector<
    start.Header,
    start.Provider,
    start.Listener
  > = new WebSocketConnector(connection.headers ?? ({} as any), provider);
  await connector.connect(
    `${connection.host.endsWith("/") ? connection.host.substring(0, connection.host.length - 1) : connection.host}${start.path()}`,
  );
  const driver: Driver<start.Listener> = connector.getDriver();
  return {
    connector,
    driver,
  };
}
export namespace start {
  export type Output = {
    connector: WebSocketConnector<Header, Provider, Listener>;
    driver: Driver<Listener>;
  };
  export type Header = undefined;
  export type Provider = IAgenticaRpcListener;
  export type Listener = IAgenticaRpcService<"chatgpt">;

  export const path = () => "/chat";
}
```
  </Tabs.Tab>
</Tabs>